!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-dispatch"),require("d3-drag"),require("d3-interpolate"),require("d3-selection"),require("d3-transition")):"function"==typeof define&&define.amd?define(["exports","d3-dispatch","d3-drag","d3-interpolate","d3-selection","d3-transition"],n):n(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,n,e,o,i,r){"use strict";function u(t){return function(){return t}}function h(t,n,e){this.target=t,this.type=n,this.transform=e}function s(t,n,e,o){this.kx=e,this.ky=o||e,this.x=t,this.y=n}function c(t){return t.__zoom||z}function a(){i.event.stopImmediatePropagation()}function f(){i.event.preventDefault()}function l(){i.event.preventDefault(),i.event.stopImmediatePropagation()}function m(){return!i.event.button}function p(){var t,n,e=this;if(e instanceof SVGElement)e=e.ownerSVGElement||e,t=e.width.baseVal.value,n=e.height.baseVal.value;else{if(!(e&&e.clientWidth&&e.clientHeight))throw"d3-xyzoom failed to constrain scales because extent is undefined.";t=e.clientWidth,n=e.clientHeight}return[[0,0],[t,n]]}function y(){return this.__zoom||z}function d(){return-i.event.deltaY*(i.event.deltaMode?120:1)/500}function v(){return"ontouchstart"in this}function x(){function t(t){t.property("__zoom",y).on("wheel.zoom",b).on("mousedown.zoom",T).on("dblclick.zoom",Y).filter(v).on("touchstart.zoom",q).on("touchmove.zoom",X).on("touchend.zoom touchcancel.zoom",E).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function c(t,n,e){return n=Math.max(A,Math.min(K,n)),e=Math.max(B,Math.min(W,e)),n===t.kx&&e===t.ky?t:new s(t.x,t.y,n,e)}function x(t,n,e){var o=n[0]-e[0]*t.kx,i=n[1]-e[1]*t.ky;return o===t.x&&i===t.y?t:new s(o,i,t.kx,t.ky)}function k(t,n){var e=t.invertX(n[0][0])-R,o=t.invertX(n[1][0])-C,i=t.invertY(n[0][1])-F,r=t.invertY(n[1][1])-J;return t.translate(o>e?(e+o)/2:Math.min(0,e)||Math.max(0,o),r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r))}function _(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function g(t,n){t.on("start.zoom",function(){w(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){w(this,arguments).end()}).tween("zoom",function(){var t=this,e=arguments,o=w(t,e),i=t.__zoom,r="function"==typeof n?n.apply(t,e):n,u=Q(i.x,r.x),h=Q(i.y,r.y),c=Q(i.kx,r.kx),a=Q(i.ky,r.ky);return function(t){t=1===t?r:new s(u(t),h(t),c(t),a(t)),o.zoom(null,t)}})}function w(t,n){for(var e,o=0,i=U.length;o<i;++o)if((e=U[o]).that===t)return e;return new M(t,n)}function M(t,n){this.that=t,this.args=n,this.index=-1,this.active=0,this.extent=S.apply(t,n)}function b(){function t(){n.wheel=null,n.end()}if(P.apply(this,arguments)){var n=w(this,arguments),e=this.__zoom,o=Math.max(A,Math.min(K,e.kx*(1+N*(-1+Math.pow(2,j.apply(this,arguments)))))),u=Math.max(B,Math.min(W,e.ky*(1+O*(-1+Math.pow(2,j.apply(this,arguments)))))),h=i.mouse(this);if(e.kx===A&&(o=u>=A?o:A),e.kx===K&&(o=u<=K?o:K),e.ky===B&&(u=o>=B?u:B),e.ky===W&&(u=o<=W?u:W),n.wheel)n.mouse[0][0]===h[0]&&n.mouse[0][1]===h[1]||(n.mouse[1]=e.invert(n.mouse[0]=h)),clearTimeout(n.wheel);else{if(e.kx===u&&e.ky===o)return;n.mouse=[h,e.invert(h)],r.interrupt(this),n.start()}et?f():l(),n.wheel=setTimeout(t,tt),n.zoom("mouse",k(x(c(e,o,u),n.mouse[0],n.mouse[1]),n.extent))}}function T(){function t(){if(et?f():l(),!o.moved){var t=i.event.clientX-s,n=i.event.clientY-c;o.moved=o.moved||t*t+n*n>nt}o.zoom("mouse",k(x(o.that.__zoom,o.mouse[0]=i.mouse(o.that),o.mouse[1]),o.extent))}function n(){u.on("mousemove.zoom mouseup.zoom",null),e.dragEnable(i.event.view,o.moved),et?f():l(),o.end()}if(!I&&P.apply(this,arguments)){var o=w(this,arguments),u=i.select(i.event.view).on("mousemove.zoom",t,!0).on("mouseup.zoom",n,!0),h=i.mouse(this),s=i.event.clientX,c=i.event.clientY;e.dragDisable(i.event.view),a(),o.mouse=[h,this.__zoom.invert(h)],r.interrupt(this),o.start()}}function Y(){if(P.apply(this,arguments)){var n=this.__zoom,e=i.mouse(this),o=n.invert(e),r=n.kx*(1+N*((i.event.shiftKey?.5:2)-1)),u=n.ky*(1+O*((i.event.shiftKey?.5:2)-1)),h=k(x(c(n,r,u),e,o),S.apply(this,arguments));et?f():l(),L>0?i.select(this).transition().duration(L).call(g,h,e):i.select(this).call(t.transform,h)}}function q(){if(P.apply(this,arguments)){var t,n,e,o=w(this,arguments),u=i.event.changedTouches,h=u.length;for(a(),t=0;t<h;++t)n=u[t],e=i.touch(this,u,n.identifier),e=[e,this.__zoom.invert(e),n.identifier],o.touch0?o.touch1||(o.touch1=e):o.touch0=e;if(V&&(V=clearTimeout(V),!o.touch1))return o.end(),void((e=i.select(this).on("dblclick.zoom"))&&e.apply(this,arguments));i.event.touches.length===h&&(V=setTimeout(function(){V=null},$),r.interrupt(this),o.start())}}function X(){var t,n,e,o,r=w(this,arguments),u=i.event.changedTouches,h=u.length;for(et?f():l(),V&&(V=clearTimeout(V)),t=0;t<h;++t)n=u[t],e=i.touch(this,u,n.identifier),r.touch0&&r.touch0[2]===n.identifier?r.touch0[0]=e:r.touch1&&r.touch1[2]===n.identifier&&(r.touch1[0]=e);if(n=r.that.__zoom,r.touch1){var s=r.touch0[0],a=r.touch0[1],m=r.touch1[0],p=r.touch1[1],y=(y=m[0]-s[0])*y+(y=m[1]-s[1])*y,d=(d=p[0]-a[0])*d+(d=p[1]-a[1])*d;n=c(n,Math.sqrt(y/d),Math.sqrt(y/d)),e=[(s[0]+m[0])/2,(s[1]+m[1])/2],o=[(a[0]+p[0])/2,(a[1]+p[1])/2]}else{if(!r.touch0)return;e=r.touch0[0],o=r.touch0[1]}r.zoom("touch",k(x(n,e,o),r.extent))}function E(){var t,n,e=w(this,arguments),o=i.event.changedTouches,r=o.length;for(a(),I&&clearTimeout(I),I=setTimeout(function(){I=null},$),t=0;t<r;++t)n=o[t],e.touch0&&e.touch0[2]===n.identifier?delete e.touch0:e.touch1&&e.touch1[2]===n.identifier&&delete e.touch1;e.touch1&&!e.touch0&&(e.touch0=e.touch1,delete e.touch1),e.touch0?e.touch0[1]=this.__zoom.invert(e.touch0[0]):e.end()}function D(){A=C!==R?Math.max(G,(S()[1][0]-S()[0][0])/(C-R)):1/0,B=J!==F?Math.max(H,(S()[1][1]-S()[0][1])/(J-F)):1/0}var V,I,P=m,S=p,j=d,A=0,B=0,G=0,H=0,K=1/0,W=1/0,N=1,O=1,R=-1/0,C=1/0,F=-1/0,J=1/0,L=250,Q=o.interpolateNumber,U=[],Z=n.dispatch("start","zoom","end"),$=500,tt=150,nt=0,et=!1;return t.transform=function(t,n){var e=t.selection?t.selection():t;e.property("__zoom",y),t!==e?g(t,n):e.interrupt().each(function(){w(this,arguments).start().zoom(null,"function"==typeof n?n.apply(this,arguments):n).end()})},t.scaleBy=function(n,e,o){t.scaleTo(n,function(){return this.__zoom.kx*("function"==typeof e?e.apply(this,arguments):e)},function(){return this.__zoom.ky*("function"==typeof o?o.apply(this,arguments):o)})},t.scaleTo=function(n,e,o){t.transform(n,function(){var t=S.apply(this,arguments),n=this.__zoom,i=_(t),r=n.invert(i);return k(x(c(n,"function"==typeof e?e.apply(this,arguments):e,"function"==typeof o?o.apply(this,arguments):o),i,r),t)})},t.translateBy=function(n,e,o){t.transform(n,function(){return k(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof o?o.apply(this,arguments):o),S.apply(this,arguments))})},t.translateTo=function(n,e,o){t.transform(n,function(){var t=S.apply(this,arguments),n=this.__zoom,i=_(t);return k(z.translate(i[0],i[1]).scale(n.kx,n.ky).translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof o?o.apply(this,arguments):o),t)})},M.prototype={start:function(){return 1==++this.active&&(this.index=U.push(this)-1,this.emit("start")),this},zoom:function(t,n){return this.mouse&&"mouse"!==t&&(this.mouse[1]=n.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=n.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=n.invert(this.touch1[0])),this.that.__zoom=n,this.emit("zoom"),this},end:function(){return 0==--this.active&&(U.splice(this.index,1),this.index=-1,this.emit("end")),this},emit:function(n){i.customEvent(new h(t,n,this.that.__zoom),Z.apply,Z,[n,this.that,this.args])}},t.clickDistance=function(n){return arguments.length?(nt=(n=+n)*n,t):Math.sqrt(nt)},t.wheelDelta=function(n){return arguments.length?(j="function"==typeof n?n:u(+n),t):j},t.filter=function(n){return arguments.length?(P="function"==typeof n?n:u(!!n),t):P},t.extent=function(n){return arguments.length?(S="function"==typeof n?n:u([[+n[0][0],+n[0][1]],[+n[1][0],+n[1][1]]]),D(),t):S},t.scaleExtent=function(n){return arguments.length?(Array.isArray(n[0])?(G=+n[0][0],K=+n[0][1],H=+n[1][0],W=+n[1][1]):(G=+n[0],K=+n[1],H=G,W=K),D(),t):[[G,K],[H,W]]},t.scaleRatio=function(n){return arguments.length?(N=+n[0],O=+n[1],t):[N,O]},t.translateExtent=function(n){return arguments.length?(R=+n[0][0],C=+n[1][0],F=+n[0][1],J=+n[1][1],D(),t):[[R,F],[C,J]]},t.duration=function(n){return arguments.length?(L=+n,t):L},t.interpolate=function(n){return arguments.length?(Q=n,t):Q},t.on=function(){var n=Z.on.apply(Z,arguments);return n===Z?t:n},t.propagate=function(n){return"boolean"==typeof n&&(et=n),t},t}s.prototype={constructor:s,scale:function(t,n){return n=void 0===n?t:n,1!==t||n&&1!==n?new s(this.x,this.y,this.kx*t,this.ky*n):this},translate:function(t,n){return 0===t&0===n?this:new s(this.x+this.kx*t,this.y+this.ky*n,this.kx,this.ky)},apply:function(t){return[t[0]*this.kx+this.x,t[1]*this.ky+this.y]},applyX:function(t){return t*this.kx+this.x},applyY:function(t){return t*this.ky+this.y},invert:function(t){return[(t[0]-this.x)/this.kx,(t[1]-this.y)/this.ky]},invertX:function(t){return(t-this.x)/this.kx},invertY:function(t){return(t-this.y)/this.ky},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.kx+","+this.ky+")"}};var z=new s(0,0,1,1);c.prototype=s.prototype,t.xyzoom=x,t.xyzoomTransform=c,t.xyzoomIdentity=z,Object.defineProperty(t,"__esModule",{value:!0})});